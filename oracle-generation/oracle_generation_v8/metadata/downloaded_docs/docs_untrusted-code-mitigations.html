<!doctype html><html lang=en><meta charset=utf-8><title>Untrusted code mitigations · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/favicon.png rel=icon sizes=48x48><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="If you embed V8 and run untrusted JavaScript code, enable V8’s mitigations to help protect against speculative side-channel attacks." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>Show navigation</a><nav><ul><li><a href=/ >Home</a><li><a href=/blog>Blog</a><li class=current><a href=/docs>Docs</a><li><a href=/tools>Tools</a><li><a href=/features title="JavaScript and WebAssembly language features">JS/Wasm features</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><h1>Untrusted code mitigations</h1><p>In early 2018, researchers from Google’s Project Zero disclosed <a href=https://googleprojectzero.blogspot.com/2018/01/reading-privileged-memory-with-side.html>a new class of attacks</a> which <a href=https://security.googleblog.com/2018/01/more-details-about-mitigations-for-cpu_4.html>exploit</a> speculative execution optimizations used by many CPUs. Because V8 uses an optimizing JIT compiler, TurboFan, to make JavaScript run quickly, in certain circumstances it is vulnerable to the side-channel attacks described in the disclosure.<h2 id=nothing-changes-if-you-execute-only-trustworthy-code tabindex=-1>Nothing changes if you execute only trustworthy code <a href=#nothing-changes-if-you-execute-only-trustworthy-code class=bookmark>#</a></h2><p>If your product only uses an embedded instance of V8 to execute JavaScript or WebAssembly code that is entirely under your control, then your usage of V8 is likely unaffected by the Speculative Side-Channel Attacks (SSCA) vulnerability. A Node.js instance running only code that you trust is one such unaffected example.<p>In order to take advantage of the vulnerability, an attacker has to execute carefully crafted JavaScript or WebAssembly code in your embedded environment. If, as a developer, you have complete control over the code executed in your embedded V8 instance, then that is very unlikely to be possible. However, if your embedded V8 instance allows arbitrary or otherwise untrustworthy JavaScript or WebAssembly code to be downloaded and executed, or even generates and subsequently executes JavaScript or WebAssembly code that isn’t fully under your control (e.g. if it uses either as a compilation target), you may need to consider mitigations.<h2 id=if-you-do-execute-untrusted-code%E2%80%A6 tabindex=-1>If you do execute untrusted code… <a href=#if-you-do-execute-untrusted-code%E2%80%A6 class=bookmark>#</a></h2><h3 id=update-to-the-latest-v8-to-benefit-from-mitigations-and-enable-mitigations tabindex=-1>Update to the latest V8 to benefit from mitigations and enable mitigations <a href=#update-to-the-latest-v8-to-benefit-from-mitigations-and-enable-mitigations class=bookmark>#</a></h3><p>Mitigations for this class of attack are available in V8 itself starting with <a href=https://chromium.googlesource.com/v8/v8/+/e6eddfe4d1ed9d96b453d14b84ac19769388d8b1>V8 v6.4.388.18</a>, so updating your embedded copy of V8 to <a href=https://chromium.googlesource.com/v8/v8/+/e6eddfe4d1ed9d96b453d14b84ac19769388d8b1>v6.4.388.18</a> or later is advised. Older versions of V8, including versions of V8 that still use FullCodeGen and/or CrankShaft, do not have mitigations for SSCA.<p>Starting in <a href=https://chromium.googlesource.com/v8/v8/+/e6eddfe4d1ed9d96b453d14b84ac19769388d8b1>V8 v6.4.388.18</a>, a new flag has been introduced to V8 to help provide protection against SSCA vulnerabilities. This flag, called <code>--untrusted-code-mitigations</code>, is enabled by default at runtime through a build-time GN flag called <code>v8_untrusted_code_mitigations</code>.<p>These mitigations are enabled by the <code>--untrusted-code-mitigations</code> runtime flag:<ul><li>Masking of addresses before memory accesses in WebAssembly and asm.js to ensure that speculatively executed memory loads cannot access memory outside of the WebAssembly and asm.js heaps.<li>Masking of the indices in JIT code used to access JavaScript arrays and strings in speculatively executed paths to ensure speculative loads cannot be made with arrays and string to memory addresses that should not accessible to JavaScript code.</ul><p>Embedders should be aware that the mitigations may come with a performance trade-off. The actual impact depends significantly on your workload. For workloads such as Speedometer the impact is negligible but for more extreme computational workloads it can be as much as 15%. If you fully trust the JavaScript and WebAssembly code that your embedded V8 instance executes, you may choose to disable these JIT mitigations by specifying the flag <code>--no-untrusted-code-mitigations</code> at runtime. The <code>v8_untrusted_code_mitigations</code> GN flag can be used to enable or disable the mitigations at build time.<p>Note that V8 defaults to disabling these mitigations on platforms where it is assumed the embedder will use process isolation, such as platforms where Chromium uses site isolation.<h3 id=sandbox-untrusted-execution-in-a-separate-process tabindex=-1>Sandbox untrusted execution in a separate process <a href=#sandbox-untrusted-execution-in-a-separate-process class=bookmark>#</a></h3><p>If you execute untrusted JavaScript and WebAssembly code in a separate process from any sensitive data, the potential impact of SSCA is greatly reduced. Through process isolation, SSCA attacks are only able to observe data that is sandboxed inside the same process along with the executing code, and not data from other processes.<h3 id=consider-tuning-your-offered-high-precision-timers tabindex=-1>Consider tuning your offered high-precision timers <a href=#consider-tuning-your-offered-high-precision-timers class=bookmark>#</a></h3><p>A high-precision timer makes it easier to observe side channels in the SSCA vulnerability. If your product offers high-precision timers that can be accessed by untrusted JavaScript or WebAssembly code, consider making these timers more coarse or adding jitter to them.</main><footer id=footer><div><nav><a href=/logo>Branding</a> <a href=/terms>Terms</a> <a href=https://policies.google.com/privacy>Privacy</a> <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> <a href=https://github.com/v8/v8.dev/tree/main/./src/docs/untrusted-code-mitigations.md rel=nofollow>Edit this page on GitHub</a></nav><dark-mode-toggle dark="Light Mode" light="Dark Mode" permanent></dark-mode-toggle></div><p><small>Except as otherwise noted, any code samples from the V8 project are licensed under <a href=https://chromium.googlesource.com/v8/v8.git/+/main/LICENSE>V8’s BSD-style license</a>. Other content on this page is licensed under <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a>. For details, see <a href=/terms#site-policies>our site policies</a>.</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.js></script>